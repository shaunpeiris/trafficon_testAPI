<?php
if (isset($_POST['submit'])) {
    $curl = curl_init();

    curl_setopt_array($curl, array(
        CURLOPT_URL => 'https://regapi.tra-con.co/secured-registration',
        CURLOPT_RETURNTRANSFER => true,
        CURLOPT_ENCODING => '',
        CURLOPT_MAXREDIRS => 10,
        CURLOPT_TIMEOUT => 0,
        CURLOPT_FOLLOWLOCATION => true,
        CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,
        CURLOPT_CUSTOMREQUEST => 'POST',
        CURLOPT_POSTFIELDS => http_build_query(array(
            'offer_id' => 294,
            'aff_id' => 3786,
            'first_name' => $_POST['first_name'],
            'last_name' => $_POST['last_name'],
            'email' => $_POST['email'],
            'password' => '123123Abc!', // autogenerated
            'area_code' => 'DE',
            'phone' => $_POST['phone'],
            'ip' => $_SERVER['REMOTE_ADDR'],
            'country' => 'Germany',
            'iso' => 'DE',
            'aff_sub' => '_PUT_AFF_SUB_IF_REQUIRED_',
            'aff_sub2' => '_PUT_AFF_SUB_2_IF_REQUIRED_',
            'aff_sub3' => '_PUT_AFF_SUB_3_IF_REQUIRED_',
            'aff_sub4' => '_PUT_AFF_SUB_4_IF_REQUIRED_',
            'aff_sub5' => '_PUT_AFF_SUB_5_IF_REQUIRED_',
        )),
        CURLOPT_HTTPHEADER => array(
            'Content-Type: application/x-www-form-urlencoded'
        ),
    ));

    $response = curl_exec($curl);
    curl_close($curl);
    $httpCode = curl_getinfo($curl, CURLINFO_HTTP_CODE);

    switch ($httpCode) {
        /**
         * BAD TOKEN / AUTH / WHITELISTING CASE
         */
        case 401:
            echo "Invalid Auth";
            break;
        /**
         * Validation Errors
         */
        case 400:
            foreach (json_decode($response)->validation_errors as $key => $value) {
                echo $key . ": " . implode("</br>", $value);
            }
            break;
        /**
         * Success
         */
        case 201:
            header('Location: ' . json_decode($response)->auto_login_url);
            break;
        /**
         * Declined
         */
        case 500:
            echo "Lead Declined";
            break;
    }

    die();
} else {
    ?>
<html lang="en">
    <head>
        <style type="text/css">

            body{background:#59ABE3;margin:0}
            .form{width:400px;height:500px;background:#e6e6e6;border-radius:8px;box-shadow:0 0 40px -10px #000;margin:calc(50vh - 220px) auto;padding:20px 30px;max-width:calc(100vw - 40px);box-sizing:border-box;font-family:'Montserrat',sans-serif;position:relative}
            h2{margin:10px 0;padding-bottom:10px;width:100%;color:#78788c;border-bottom:2px solid #78788c}
            input{width:100%;padding:10px;box-sizing:border-box;background:none;outline:none;resize:none;border:0;font-family:'Montserrat',sans-serif;transition:all .3s;border-bottom:2px solid #bebed2}
            input:focus{border-bottom:2px solid #78788c}
            p:before{content:attr(type);display:block;margin:28px 0 0;font-size:14px;color:#5a5a5a}
            button{float:right;padding:8px 12px;margin:8px 0 0;font-family:'Montserrat',sans-serif;border:2px solid #78788c;background:0;color:#5a5a6e;cursor:pointer;transition:all .3s}
            button:hover{background:#78788c;color:#fff}
            div{content:'Hi';position:absolute;bottom:-15px;right:-20px;background:#50505a;color:#fff;width:320px;padding:16px 4px 16px 0;border-radius:6px;font-size:13px;box-shadow:10px 10px 40px -14px #000}
            span{margin:0 5px 0 15px}
        </style>
        <meta charset="utf-8">

        <title>Form P5 Api</title>
        <meta name="description" content="Form P5 Api Example">
        <meta name="author" content="SitePoint">
    </head>

    <body>

        <form class="form" action="" method="post">
          <h2>REGISTER</h2>
          <p type="First Name:"><input type="text" id="fname" required=required name="first_name" value="" placeholder="John"></p>
          <p type="Last Name:"><input type="text" id="lname" required=required name="last_name" value="" value="Last Name" placeholder="Deo"></p>
          <p type="Email:"><input type="email" id="email" required=required name="email" value="" placeholder="john_deo@gmail.com"></p>
          <p type="Phone:"><input type="number" id="phone" required=required name="phone" value="" placeholder="+65 91231234"></input></p>
          <input type="hidden" id="action" name="submit" value="true">
          <button type="submit" name="submit">Submit</button>
      </form>
      <br>
  </body>
</html>
    <?php
}
